{%- comment -%}
  Structured data snippet for rich snippets
  Usage: {% render 'structured-data' %}
{%- endcomment -%}

{%- comment -%} Organization structured data {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ shop.name | escape }}",
  "url": "{{ shop.url }}",
  "logo": "{% if settings.logo %}{{ settings.logo | image_url: width: 200 }}{% endif %}",
  "description": "{{ shop.description | escape }}",
  "foundingDate": "{{ shop.created_at | date: '%Y-%m-%d' }}",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "{{ shop.address.address1 | escape }}",
    "addressLocality": "{{ shop.address.city | escape }}",
    "addressRegion": "{{ shop.address.province | escape }}",
    "postalCode": "{{ shop.address.zip | escape }}",
    "addressCountry": "{{ shop.address.country | escape }}"
  },
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "{{ shop.phone | escape }}",
    "contactType": "customer service",
    "availableLanguage": "{{ request.locale.iso_code }}"
  },
  "sameAs": [
    {%- if settings.social_facebook_link -%}"{{ settings.social_facebook_link }}"{%- endif -%}
    {%- if settings.social_instagram_link -%},"{{ settings.social_instagram_link }}"{%- endif -%}
    {%- if settings.social_twitter_link -%},"{{ settings.social_twitter_link }}"{%- endif -%}
    {%- if settings.social_pinterest_link -%},"{{ settings.social_pinterest_link }}"{%- endif -%}
    {%- if settings.social_youtube_link -%},"{{ settings.social_youtube_link }}"{%- endif -%}
    {%- if settings.social_tiktok_link -%},"{{ settings.social_tiktok_link }}"{%- endif -%}
  ]
}
</script>

{%- comment -%} Website structured data {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ shop.name | escape }}",
  "url": "{{ shop.url }}",
  "description": "{{ shop.description | escape }}",
  "inLanguage": "{{ request.locale.iso_code }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ shop.url }}/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

{%- comment -%} Product structured data {%- endcomment -%}
{%- if template contains 'product' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.title | escape }}",
  "description": "{{ product.description | strip_html | escape }}",
  "image": [
    {%- for image in product.images -%}
      "{{ image | image_url: width: 800 }}"{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ],
  "brand": {
    "@type": "Brand",
    "name": "{{ product.vendor | escape }}"
  },
  "category": "{{ product.type | escape }}",
  "sku": "{{ product.selected_or_first_available_variant.sku | escape }}",
  "mpn": "{{ product.selected_or_first_available_variant.sku | escape }}",
  "offers": {
    "@type": "Offer",
    "price": "{{ product.price | money_without_currency | remove: ',' }}",
    "priceCurrency": "{{ cart.currency.iso_code }}",
    "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
    "url": "{{ shop.url }}{{ product.url }}",
    "priceValidUntil": "{{ 'now' | date: '%s' | plus: 31536000 | date: '%Y-%m-%d' }}",
    "seller": {
      "@type": "Organization",
      "name": "{{ shop.name | escape }}"
    }
  }
  {%- if product.variants.size > 1 -%}
  ,"hasVariant": [
    {%- for variant in product.variants -%}
    {
      "@type": "ProductModel",
      "name": "{{ variant.title | escape }}",
      "sku": "{{ variant.sku | escape }}",
      "offers": {
        "@type": "Offer",
        "price": "{{ variant.price | money_without_currency | remove: ',' }}",
        "priceCurrency": "{{ cart.currency.iso_code }}",
        "availability": "{% if variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}"
      }
    }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ]
  {%- endif -%}
  {%- if product.reviews.size > 0 -%}
  ,"aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ product.reviews.average_rating }}",
    "reviewCount": "{{ product.reviews.size }}"
  }
  {%- endif -%}
}
</script>
{%- endif -%}

{%- comment -%} Collection structured data {%- endcomment -%}
{%- if template contains 'collection' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ collection.title | escape }}",
  "description": "{{ collection.description | strip_html | escape }}",
  "url": "{{ shop.url }}{{ collection.url }}",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": "{{ collection.products_count }}",
    "itemListElement": [
      {%- for product in collection.products limit: 10 -%}
      {
        "@type": "Product",
        "name": "{{ product.title | escape }}",
        "url": "{{ shop.url }}{{ product.url }}",
        "image": "{{ product.featured_media | image_url: width: 400 }}",
        "offers": {
          "@type": "Offer",
          "price": "{{ product.price | money_without_currency | remove: ',' }}",
          "priceCurrency": "{{ cart.currency.iso_code }}"
        }
      }{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    ]
  }
}
</script>
{%- endif -%}

{%- comment -%} Article structured data {%- endcomment -%}
{%- if template contains 'article' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ article.title | escape }}",
  "description": "{{ article.excerpt | default: article.content | strip_html | truncate: 160 | escape }}",
  "image": "{% if article.image %}{{ article.image | image_url: width: 1200 }}{% endif %}",
  "author": {
    "@type": "Person",
    "name": "{{ article.author | escape }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ shop.name | escape }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{% if settings.logo %}{{ settings.logo | image_url: width: 200 }}{% endif %}"
    }
  },
  "datePublished": "{{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' }}",
  "dateModified": "{{ article.updated_at | date: '%Y-%m-%dT%H:%M:%S%z' }}",
  "mainEntityOfPage": "{{ shop.url }}{{ article.url }}"
}
</script>
{%- endif -%}

{%- comment -%} Breadcrumb structured data {%- endcomment -%}
{%- if template contains 'product' or template contains 'collection' or template contains 'blog' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ shop.url }}"
    }
    {%- if template contains 'collection' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "{{ collection.title | escape }}",
      "item": "{{ shop.url }}{{ collection.url }}"
    }
    {%- endif -%}
    {%- if template contains 'product' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "{{ collection.title | escape }}",
      "item": "{{ shop.url }}{{ collection.url }}"
    },{
      "@type": "ListItem",
      "position": 3,
      "name": "{{ product.title | escape }}",
      "item": "{{ shop.url }}{{ product.url }}"
    }
    {%- endif -%}
    {%- if template contains 'blog' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "{{ blog.title | escape }}",
      "item": "{{ shop.url }}{{ blog.url }}"
    }
    {%- endif -%}
    {%- if template contains 'article' -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "{{ blog.title | escape }}",
      "item": "{{ shop.url }}{{ blog.url }}"
    },{
      "@type": "ListItem",
      "position": 3,
      "name": "{{ article.title | escape }}",
      "item": "{{ shop.url }}{{ article.url }}"
    }
    {%- endif -%}
  ]
}
</script>
{%- endif -%}
