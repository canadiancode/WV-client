<style>
#wv-public-listing {
  padding: 1rem 0rem;
}
#wv-public-listing .title {
  font-family: var(--main-heading-font-family);
  font-size: var(--main-heading-font-size);
}
#wv-public-listing .title-favourite {
  display: flex;
  justify-content: space-between;
}
#wv-public-listing .favourite-creator-star {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  border: 1px solid;
  background: var(--off-white);
  cursor: pointer;
  padding: 5px;
}
#wv-public-listing .title-favourite .favorited {
  background: radial-gradient(circle,rgba(255, 234, 148, 1) 0%, rgba(255, 202, 28, 1) 52%, rgba(255, 202, 28, 1) 100%);
}
/* Profile & background images */
#wv-public-listing .creator-profile-top .landscape-bg-container img {
  height: 200px;
  object-fit: cover;
  width: 100%;
}
#wv-public-listing .creator-profile-top .profile-picture-container {
  height: 50px;
  padding: 0rem 20px;
  position: relative;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container a {
  display: flex;
  align-items: center;
}
#wv-public-listing .creator-profile-top .profile-picture-container img {
  height: 100px;
  width: 100px;
  transform: translateY(-50px);
  border-radius: 50%;
  border: 2px solid white;
}

/* Social links */
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container {
  position: absolute;
  top: 0;
  right: 0;
  display: flex;
  gap: 5px;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container a svg {
  height: 50px;
  width: 50px;
  filter: grayscale(1);
  transition: 0.3s ease-in-out;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container a .unknown-link {
  height: 40px;
  width: 40px;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container a svg:hover {
  filter: grayscale(0);
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container .instagram svg {
  transform: scale(0.82);
  opacity: 0.8;
  transition: 0.3s ease-in-out;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container .instagram svg:hover {
  opacity: 1;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container .tiktok svg {
  transform: scale(0.71);
  opacity: 0.7;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container .tiktok svg:hover {
  opacity: 1;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container .x svg {
  transform: scale(0.67);
  opacity: 0.7;
}
#wv-public-listing .creator-profile-top .profile-picture-container .social-links-container .x svg:hover {
  opacity: 1;
}

/* Creator name and bio */
#wv-public-listing .creator-profile-top .creator-profile-copy {
  padding: 5px 10px;
}
#wv-public-listing .creator-profile-top .creator-profile-copy h2 {
  font-size: 19px;
  margin-bottom: 0px;
  padding-bottom: 0px;
  min-height: 25px;
}
#wv-public-listing .creator-profile-top .creator-profile-copy p {
  margin-top: 5px;
  min-height: 25px;
}
#wv-public-listing .item-forsale-grid {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 25px;
}

/* Displayed products */
#product-list-container {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 10px; 
  list-style-type: none;
  padding: 0;
}
</style>

<div id='wv-public-listing'>

  <div class='title-favourite'>
    <h1 class='title'>{{ page.title }}</h1>
    <svg class='favourite-creator-star' id="fi_2956792" height="512" viewBox="0 0 32 32" width="512" xmlns="http://www.w3.org/2000/svg" data-name="Layer 3"><path d="m23.479 29.691a2.325 2.325 0 0 1 -1.089-.27l-6.233-3.276a.333.333 0 0 0 -.314 0l-6.232 3.276a2.338 2.338 0 0 1 -3.393-2.465l1.19-6.939a.337.337 0 0 0 -.1-.3l-5.038-4.917a2.338 2.338 0 0 1 1.3-3.989l6.963-1.011a.337.337 0 0 0 .254-.185l3.113-6.315a2.337 2.337 0 0 1 4.193 0l3.115 6.313a.34.34 0 0 0 .254.185l6.969 1.012a2.339 2.339 0 0 1 1.3 3.989l-5.043 4.914a.339.339 0 0 0 -.1.3l1.19 6.939a2.341 2.341 0 0 1 -2.3 2.735zm-7.479-5.586a2.325 2.325 0 0 1 1.088.27l6.232 3.275a.321.321 0 0 0 .356-.025.325.325 0 0 0 .135-.331l-1.191-6.94a2.343 2.343 0 0 1 .672-2.069l5.043-4.915a.338.338 0 0 0 -.188-.576l-6.968-1.013a2.335 2.335 0 0 1 -1.76-1.279l-3.119-6.314a.338.338 0 0 0 -.606 0l-3.113 6.312a2.335 2.335 0 0 1 -1.761 1.279l-6.967 1.015a.337.337 0 0 0 -.187.576l5.042 4.915a2.343 2.343 0 0 1 .672 2.069l-1.191 6.94a.338.338 0 0 0 .492.356l6.231-3.276a2.335 2.335 0 0 1 1.088-.269z"></path></svg>
  </div>


  <!-- Top preview -->
  <div class='creator-profile-top'>
    <div class='landscape-bg-container'>
      {% assign custom_bg = page.metafields.custom.creator_profile_background_image %}
      <img
        class='landscape-bg'
        src='{% if custom_bg and custom_bg.value %}{{ custom_bg.value | img_url: 'master' }}{% else %}https://cdn.shopify.com/s/files/1/0024/9551/2691/files/unknown-user-bg.png?v=1752425659{% endif %}'
        alt='{{ page.metafields.custom.creator_display_name }} profile background photo'
      />
    </div>
    <div class='profile-picture-container'>

      <div class='social-links-container'>
        {% assign raw_links = page.metafields.custom.social_links %}
        {% assign links_array = raw_links | remove: '[' | remove: ']' | split: '","' %}
        {% for link in links_array %}
          {% assign clean_link = link | remove: '"' | strip %}
          {% if clean_link contains 'onlyfans.com' %}
            <a target='_blank' class='onlyfans' href='{{ clean_link }}'> <!-- Onlyfans -->
              <svg viewBox="-20.62 0.53 820.42 555.49" xmlns="http://www.w3.org/2000/svg" width="2500" height="1650"><path d="M266.82.53c35 0 69.65 6.91 101.98 20.34s61.71 33.11 86.45 57.93c24.75 24.81 44.37 54.27 57.77 86.7a267.919 267.919 0 0 1 20.29 102.27c0 108.09-64.93 205.53-164.51 246.89s-214.2 18.5-290.41-57.93C2.18 380.3-20.62 265.36 20.62 165.5 61.87 65.64 159.04.53 266.82.53zm0 347.4c10.5.01 20.9-2.05 30.61-6.07s18.52-9.93 25.95-17.38 13.31-16.29 17.33-26.02a80.365 80.365 0 0 0 6.06-30.7c0-32.43-19.48-61.66-49.35-74.07s-64.26-5.55-87.12 17.38-29.7 57.41-17.33 87.37 41.53 49.49 73.86 49.49z" fill="#00aeef"/><path d="M566.35 200.96c67.71 19.54 147.63 0 147.63 0-23.19 101.55-96.75 165.15-202.81 172.89a266.766 266.766 0 0 1-40.48 65.86 266.208 266.208 0 0 1-57.62 51.43c-21.6 14.24-45.15 25.25-69.92 32.68s-50.48 11.19-76.33 11.18l79.95-254.81C428.95 18.28 471.08.54 665.98.54H799.8c-22.38 98.88-99.54 174.41-233.44 200.42z" fill="#008ccf"/></svg>
            </a>
          {% elsif clean_link contains 'instagram.com' %}
            <a target='_blank' class='instagram' href='{{ clean_link }}'> <!-- Instagram -->
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="fi_15713420" viewBox="0 0 512 512"><defs><style>.cls-1{fill:url(#Nepojmenovaný_přechod_27);}.cls-2{fill:#fff;}</style><linearGradient gradientUnits="userSpaceOnUse" id="Nepojmenovaný_přechod_27" x1="328.27" x2="183.73" y1="508.05" y2="3.95"><stop offset="0" stop-color="#ffdb73"></stop><stop offset="0.08" stop-color="#fdad4e"></stop><stop offset="0.15" stop-color="#fb832e"></stop><stop offset="0.19" stop-color="#fa7321"></stop><stop offset="0.23" stop-color="#f6692f"></stop><stop offset="0.37" stop-color="#e84a5a"></stop><stop offset="0.48" stop-color="#e03675"></stop><stop offset="0.55" stop-color="#dd2f7f"></stop><stop offset="0.68" stop-color="#b43d97"></stop><stop offset="0.97" stop-color="#4d60d4"></stop><stop offset="1" stop-color="#4264db"></stop></linearGradient></defs><title></title><rect class="cls-1" height="465.06" rx="107.23" ry="107.23" width="465.06" x="23.47" y="23.47"></rect><path class="cls-2" d="M331,115.22a66.92,66.92,0,0,1,66.65,66.65V330.13A66.92,66.92,0,0,1,331,396.78H181a66.92,66.92,0,0,1-66.65-66.65V181.87A66.92,66.92,0,0,1,181,115.22H331m0-31H181c-53.71,0-97.66,44-97.66,97.66V330.13c0,53.71,44,97.66,97.66,97.66H331c53.71,0,97.66-44,97.66-97.66V181.87c0-53.71-43.95-97.66-97.66-97.66Z"></path><path class="cls-2" d="M256,198.13A57.87,57.87,0,1,1,198.13,256,57.94,57.94,0,0,1,256,198.13m0-31A88.87,88.87,0,1,0,344.87,256,88.87,88.87,0,0,0,256,167.13Z"></path><circle class="cls-2" cx="346.81" cy="163.23" r="21.07"></circle></svg>
            </a>
          {% elsif clean_link contains 'tiktok.com' %}
            <a target='_blank' class='tiktok' href='{{ clean_link }}'> <!-- TikTok -->
              <svg id="fi_3046121" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><g><g fill="#f00044"><path d="m182.1 265.4c-40.6 0-73.4 32.8-72.8 73 .4 25.8 14.6 48.2 35.5 60.7-7.1-10.9-11.3-23.8-11.5-37.7-.6-40.2 32.2-73 72.8-73 8 0 15.7 1.3 22.9 3.6v-80.5c-7.5-1.1-15.2-1.7-22.9-1.7-.4 0-.7 0-1.1 0v59.2c-7.2-2.3-14.9-3.6-22.9-3.6z"></path><path d="m357.6 24h-.6-20.8c6 30.1 22.9 56.3 46.5 74.1-15.5-20.5-24.9-46.1-25.1-74.1z"></path><path d="m480 146.5c-7.9 0-15.5-.8-23-2.2v57.7c-27.2 0-53.6-5.3-78.4-15.9-16-6.8-30.9-15.5-44.6-26l.4 177.9c-.2 40-16 77.5-44.6 105.8-23.3 23-52.8 37.7-84.8 42.4-7.5 1.1-15.2 1.7-22.9 1.7-34.2 0-66.8-11.1-93.3-31.6 3 3.6 6.2 7.1 9.7 10.5 28.8 28.4 67 44.1 107.7 44.1 7.7 0 15.4-.6 22.9-1.7 32-4.7 61.5-19.4 84.8-42.4 28.6-28.3 44.4-65.8 44.6-105.8l-1.5-177.9c13.6 10.5 28.5 19.3 44.6 26 24.9 10.5 51.3 15.9 78.4 15.9"></path></g><path d="m98.2 254.1c28.5-28.3 66.4-44 106.8-44.3v-21.3c-7.5-1.1-15.2-1.7-22.9-1.7-40.8 0-79.1 15.7-107.9 44.3-28.3 28.1-44.5 66.5-44.4 106.4 0 40.2 15.9 77.9 44.6 106.4 4.6 4.5 9.3 8.7 14.3 12.5-22.6-26.9-34.9-60.5-35-95.9.1-39.9 16.2-78.3 44.5-106.4z" fill="#08fff9"></path><path d="m457 144.3v-21.4h-.2c-27.8 0-53.4-9.2-74-24.8 17.9 23.6 44.1 40.4 74.2 46.2z" fill="#08fff9"></path><path d="m202 432.2c9.5.5 18.6-.8 27-3.5 29-9.5 49.9-36.5 49.9-68.3l.1-119v-217.4h57.2c-1.5-7.5-2.3-15.1-2.4-23h-78.8v217.3l-.1 119c0 31.8-20.9 58.8-49.9 68.3-8.4 2.8-17.5 4.1-27 3.5-12.1-.7-23.4-4.3-33.2-10.1 12.3 19 33.3 31.9 57.2 33.2z" fill="#08fff9"></path><path d="m205 486.2c32-4.7 61.5-19.4 84.8-42.4 28.6-28.3 44.4-65.8 44.6-105.8l-.4-177.9c13.6 10.5 28.5 19.3 44.6 26 24.9 10.5 51.3 15.9 78.4 15.9v-57.7c-30.1-5.8-56.3-22.6-74.2-46.2-23.6-17.8-40.6-44-46.5-74.1h-57.3v217.3l-.1 119c0 31.8-20.9 58.8-49.9 68.3-8.4 2.8-17.5 4.1-27 3.5-24-1.3-44.9-14.2-57.2-33.1-20.9-12.4-35.1-34.9-35.5-60.7-.6-40.2 32.2-73 72.8-73 8 0 15.7 1.3 22.9 3.6v-59.2c-40.4.3-78.3 16-106.8 44.3-28.3 28.1-44.5 66.5-44.4 106.3 0 35.4 12.3 69 35 95.9 26.6 20.5 59.1 31.6 93.3 31.6 7.7.1 15.4-.5 22.9-1.6z"></path></g></svg>
            </a>
          {% elsif clean_link contains 'x.com' %}
            <a target='_blank' class='x' href='{{ clean_link }}'> <!-- X -->
              <svg id="fi_5968830" enable-background="new 0 0 1227 1227" viewBox="0 0 1227 1227" xmlns="http://www.w3.org/2000/svg"><path d="m654.53 592.55 276.12 394.95h-113.32l-225.32-322.28v-.02l-33.08-47.31-263.21-376.5h113.32l212.41 303.85z"></path><path d="m1094.42 0h-961.84c-73.22 0-132.58 59.36-132.58 132.58v961.84c0 73.22 59.36 132.58 132.58 132.58h961.84c73.22 0 132.58-59.36 132.58-132.58v-961.84c0-73.22-59.36-132.58-132.58-132.58zm-311.8 1040.52-228.01-331.84-285.47 331.84h-73.78l326.49-379.5-326.49-475.17h249.02l215.91 314.23 270.32-314.23h73.78l-311.33 361.9h-.02l338.6 492.77z"></path><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
            </a>
          {% else %}
            <a target='_blank' class='social-other' href='{{ clean_link }}'> <!-- all other social links -->
              <svg class='unknown-link' id="fi_2985013" enable-background="new 0 0 64 64" height="512" viewBox="0 0 64 64" width="512" xmlns="http://www.w3.org/2000/svg"><g><g id="ARC_176_"><g><path d="m36.243 29.758c-.512 0-1.024-.195-1.414-.586-3.119-3.119-8.194-3.12-11.314 0-.78.781-2.048.781-2.828 0-.781-.781-.781-2.047 0-2.828 4.679-4.68 12.292-4.679 16.97 0 .781.781.781 2.047 0 2.828-.39.391-.903.586-1.414.586z"></path></g></g><g id="ARC_175_"><g><path d="m34.829 41.167c-3.073 0-6.146-1.17-8.485-3.509-.781-.781-.781-2.047 0-2.828.78-.781 2.048-.781 2.828 0 3.119 3.119 8.194 3.12 11.314 0 .78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828-2.34 2.339-5.413 3.509-8.485 3.509z"></path></g></g><g id="LINE_273_"><g><path d="m41.899 38.243c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828l11.172-11.172c.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828l-11.172 11.172c-.39.391-.902.586-1.414.586z"></path></g></g><g id="LINE_272_"><g><path d="m25.071 55.071c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828l6.245-6.245c.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828l-6.245 6.245c-.39.391-.902.586-1.414.586z"></path></g></g><g id="LINE_271_"><g><path d="m10.929 40.929c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828l11.172-11.171c.781-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828l-11.172 11.171c-.391.39-.903.586-1.414.586z"></path></g></g><g id="LINE_270_"><g><path d="m32.684 19.175c-.512 0-1.023-.195-1.414-.585-.781-.781-.781-2.047 0-2.829l6.245-6.246c.781-.781 2.047-.781 2.829 0 .781.781.781 2.047 0 2.829l-6.245 6.246c-.391.389-.904.585-1.415.585z"></path></g></g><g id="ARC_174_"><g><path d="m18 57.935c-3.093 0-6.186-1.15-8.485-3.45-4.6-4.6-4.6-12.371 0-16.971.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828-3.066 3.066-3.066 8.248 0 11.314s8.248 3.066 11.314 0c.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828-2.299 2.301-5.392 3.451-8.485 3.451z"></path></g></g><g id="ARC_173_"><g><path d="m53.071 27.071c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828 3.066-3.066 3.066-8.248 0-11.314s-8.248-3.066-11.314 0c-.78.781-2.048.781-2.828 0-.781-.781-.781-2.047 0-2.828 4.6-4.6 12.371-4.6 16.971 0s4.6 12.371 0 16.971c-.391.39-.903.585-1.415.585z"></path></g></g></g></svg>
            </a>
          {% endif %}
        {% endfor %}
      </div>
            
      {% assign profile_picture = page.metafields.custom.creator_profile_picture %}
      <img
        class='profile-picture'
        src='{% if profile_picture and profile_picture.value %}{{ profile_picture.value | img_url: 'master' }}{% else %}https://cdn.shopify.com/s/files/1/0024/9551/2691/files/unknown-user.png?v=1752425659{% endif %}'
        alt='{{ page.metafields.custom.creator_display_name }} profile picture'
      />
            
    </div>
                
    <div class='creator-profile-copy'>
      <h2>{{ page.metafields.custom.creator_display_name }}</h2>
      <p>{{ page.metafields.custom.creator_short_bio }}</p>
    </div>
  </div>

  <hr>

  <div class='item-forsale-grid'>
    <div class="creator-products">
      {% assign product_list = page.metafields.custom.products_sold_by_creator %}
      {% if product_list %}
        <ul class="filtered-items link-list" id="product-list-container" data-gids='{{ product_list.value | json }}'>
          <!-- JS will render product cards here -->
        </ul>
      {% else %}
        <p>The creator currently does not have any items for sale.</p>
      {% endif %}
    </div>
  </div>

</div>

<script>
  // Fetch a single product's details using its GID via the Storefront API
  async function fetchProductByGID(gid) {
    const query = `
      {
        node(id: "${gid}") {
          ... on Product {
            title
            vendor
            handle
            featuredImage {
              url
              altText
            }
            variants(first: 1) {
              edges {
                node {
                  price {
                    amount
                    currencyCode
                  }
                }
              }
            }
            metafield(namespace: "custom", key: "links_to_online_content") {
              type
              value
            }
          }
        }
      }
    `;


    const response = await fetch('/api/2023-10/graphql.json', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Shopify-Storefront-Access-Token': 'd30c12f58fe95437d0a7f5c36ea49dd9' // ⚠️ public, OK for Storefront read-only access
      },
      body: JSON.stringify({ query })
    });

    // Return parsed product node or null if it fails
    const json = await response.json();
    return json?.data?.node || null;
  }

  // Generate the HTML structure for a single product card
  function createProductCard(product) {
    const li = document.createElement('li');
    li.className = 'item-container';
  
    const priceData = product.variants?.edges?.[0]?.node?.price;
    const price = priceData ? `$${priceData.amount}` : 'N/A';
  
    // Parse the URL list metafield
    const linksRaw = product.metafield?.value || '';
    let linkCount = 0;
  
    try {
      const links = JSON.parse(linksRaw);
      if (Array.isArray(links)) {
        linkCount = links.length;
      }
    } catch (e) {
      console.warn('Failed to parse links_to_online_content metafield:', e);
    }

    let linkIcons = '';
    for (let i = 0; i < linkCount; i++) {
      linkIcons += `<svg id="fi_2985013" enable-background="new 0 0 64 64" height="512" viewBox="0 0 64 64" width="512" xmlns="http://www.w3.org/2000/svg"><g><g id="ARC_176_"><g><path d="m36.243 29.758c-.512 0-1.024-.195-1.414-.586-3.119-3.119-8.194-3.12-11.314 0-.78.781-2.048.781-2.828 0-.781-.781-.781-2.047 0-2.828 4.679-4.68 12.292-4.679 16.97 0 .781.781.781 2.047 0 2.828-.39.391-.903.586-1.414.586z"></path></g></g><g id="ARC_175_"><g><path d="m34.829 41.167c-3.073 0-6.146-1.17-8.485-3.509-.781-.781-.781-2.047 0-2.828.78-.781 2.048-.781 2.828 0 3.119 3.119 8.194 3.12 11.314 0 .78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828-2.34 2.339-5.413 3.509-8.485 3.509z"></path></g></g><g id="LINE_273_"><g><path d="m41.899 38.243c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828l11.172-11.172c.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828l-11.172 11.172c-.39.391-.902.586-1.414.586z"></path></g></g><g id="LINE_272_"><g><path d="m25.071 55.071c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828l6.245-6.245c.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828l-6.245 6.245c-.39.391-.902.586-1.414.586z"></path></g></g><g id="LINE_271_"><g><path d="m10.929 40.929c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828l11.172-11.171c.781-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828l-11.172 11.171c-.391.39-.903.586-1.414.586z"></path></g></g><g id="LINE_270_"><g><path d="m32.684 19.175c-.512 0-1.023-.195-1.414-.585-.781-.781-.781-2.047 0-2.829l6.245-6.246c.781-.781 2.047-.781 2.829 0 .781.781.781 2.047 0 2.829l-6.245 6.246c-.391.389-.904.585-1.415.585z"></path></g></g><g id="ARC_174_"><g><path d="m18 57.935c-3.093 0-6.186-1.15-8.485-3.45-4.6-4.6-4.6-12.371 0-16.971.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828-3.066 3.066-3.066 8.248 0 11.314s8.248 3.066 11.314 0c.78-.781 2.048-.781 2.828 0 .781.781.781 2.047 0 2.828-2.299 2.301-5.392 3.451-8.485 3.451z"></path></g></g><g id="ARC_173_"><g><path d="m53.071 27.071c-.512 0-1.024-.195-1.414-.586-.781-.781-.781-2.047 0-2.828 3.066-3.066 3.066-8.248 0-11.314s-8.248-3.066-11.314 0c-.78.781-2.048.781-2.828 0-.781-.781-.781-2.047 0-2.828 4.6-4.6 12.371-4.6 16.971 0s4.6 12.371 0 16.971c-.391.39-.903.585-1.415.585z"></path></g></g></g></svg>`;
    };
  
    li.innerHTML = `
      <a href="/products/${product.handle}">
        ${linkCount > 0 ? `<div class="link-icons">${linkIcons}</div>` : ''}
        <div class="product-img-container">
          <img height="160" width="160" src="${product.featuredImage?.url}" alt="${product.featuredImage?.altText || product.title}">
        </div>
        <div class="info-container">
          <p>${product.vendor}</p>
          <h5>${product.title}</h5>
          <h6>${price}</h6>
        </div>
      </a>
    `;
  
    return li;
  };

  // Orchestrates fetching all product data and rendering their cards
  async function renderProducts() {
    const container = document.getElementById('product-list-container');
    if (!container) return;

    let rawData;
    try {
      rawData = JSON.parse(container.dataset.gids);
    } catch (e) {
      console.error('Invalid JSON in data-gids:', e);
      return;
    }

    // Convert numeric IDs to Shopify GID format
    const gids = rawData.map(obj => `gid://shopify/Product/${obj.id}`);

    // Loop through each product, fetch its data, and render it
    for (const gid of gids) {
      try {
        // console.log('Fetching product by GID:', gid);
        const product = await fetchProductByGID(gid);
        if (product) {
          const card = createProductCard(product);
          container.appendChild(card);
        } else {
          console.warn('Product not found for GID:', gid);
        }
      } catch (err) {
        console.error('Error fetching/rendering product:', gid, err);
      }
    }
  }

  // Wait until DOM is ready before starting
  document.addEventListener('DOMContentLoaded', renderProducts);
</script>

{% schema %}
  {
    "name": "WV Public Listings",
    "settings": [],
    "presets": [
      {
        "name": "WV Public Listings",
      }
    ]
  }
{% endschema %}